Sub HighlightMismatch()
    Dim ws4 As Worksheet
    Dim cellD As Range
    Dim lastRow4 As Long

    Set ws4 = ThisWorkbook.Sheets("工作表4")

    lastRow4 = ws4.Cells(ws4.Rows.Count, "D").End(xlUp).Row

    For Each cellD In ws4.Range("D1:D" & lastRow4)
        If Not IsEmpty(cellD) Then

            If cellD.Value = "M1" Then

                If cellD.Row + 2 <= ws4.Rows.Count Then

                    If ws4.Cells(cellD.Row + 1, "D").Value <> ws4.Cells(cellD.Row + 2, "D").Value Then

                        If Not IsEmpty(ws4.Cells(cellD.Row + 1, "D")) Then
                            ws4.Cells(cellD.Row + 1, "D").Interior.Color = vbYellow
                        End If
                        If Not IsEmpty(ws4.Cells(cellD.Row + 2, "D")) Then
                            ws4.Cells(cellD.Row + 2, "D").Interior.Color = vbYellow
                        End If
                    End If
                End If
            End If
        End If
    Next cellD
End Sub